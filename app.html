<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRASH SYSTEM | 1X</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø®Ø§ØµØ© Ø¨ØµÙØ­Ø© ÙƒØ±Ø§Ø´ Ù„Ø¬Ø¹Ù„Ù‡Ø§ ØªØ¨Ø¯Ùˆ Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø£ÙƒØ«Ø± */
        .crash-monitor {
            background: radial-gradient(circle at center, rgba(0, 40, 0, 0.6), #000);
            border: 1px solid var(--hacker-green);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 30px rgba(0, 255, 65, 0.1);
        }
        
        /* Ø´Ø¨ÙƒØ© Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø±Ø¨Ø¹ */
        .crash-monitor::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: linear-gradient(rgba(0, 255, 65, 0.1) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 255, 65, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.3;
            z-index: 0;
        }

        .signal-label {
            font-family: 'Fira Code'; 
            color: var(--hacker-green); 
            font-size: 0.9rem; 
            letter-spacing: 2px;
            margin-bottom: 10px;
            display: block;
            text-shadow: 0 0 5px var(--hacker-green);
        }

        .crash-number {
            font-family: 'Fira Code';
            font-size: 3.5rem;
            color: #fff;
            font-weight: 900;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            position: relative;
            z-index: 1;
            min-height: 70px; /* Ù„Ù…Ù†Ø¹ Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù‚Ù… */
        }

        /* Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù„ØªÙØ§Ø­Ø© */
        .switch-btn {
            background: linear-gradient(135deg, #330000, #660000);
            border: 1px solid #ff3333;
            color: #ffcccc;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9rem;
            padding: 12px;
            animation: none; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù†Ø¨Ø¶ Ø§Ù„Ø£Ø®Ø¶Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
        }
        .switch-btn:hover {
            background: linear-gradient(135deg, #660000, #990000);
            box-shadow: 0 0 15px rgba(255, 50, 50, 0.4);
            transform: translateY(-2px);
        }

        .history-dots {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 15px;
        }
        .dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: #333;
        }
        .dot.active { background: var(--hacker-green); box-shadow: 0 0 5px var(--hacker-green); }

    </style>
</head>
<body>
    <div class="live-counter" id="liveCounter" style="top:10px; right:10px;">Live: ...</div>

    <div class="container">
        <img src="11zon_cropped.png" alt="App Logo" class="pro-logo" style="width: 100px;">

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h2 style="margin: 0; border: none; font-size: 1.4rem;">CRASH HACK V9</h2>
            <div style="font-size: 11px; background: rgba(0,255,65,0.1); padding: 4px 8px; border-radius: 4px; border: 1px solid var(--hacker-green); color: var(--hacker-green);">
                ONLINE â—
            </div>
        </div>

        <div class="history-dots">
            <div class="dot active"></div><div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>

        <div class="crash-monitor">
            <span class="signal-label">>> NEXT_ROUND_SIGNAL:</span>
            <div class="crash-number" id="randomNumber">--.--</div>
            
            <div class="progress-bar" style="background:rgba(0,0,0,0.8); height:6px; border-radius:5px; margin-top:20px; overflow:hidden; border:1px solid #333;">
                <div class="progress-fill" id="progressFill" style="background:var(--hacker-green); height:100%; width:0%; box-shadow: 0 0 10px var(--hacker-green);"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.7rem; color: #666; font-family: 'Fira Code';">
                <span>SYNC: AUTO</span>
                <span>LATENCY: 12ms</span>
            </div>
        </div>

        <button class="switch-btn" onclick="window.location.href='apple.html'">
            <span>ğŸ</span> Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªÙØ§Ø­Ø© (Apple)
        </button>

        <button class="secondary-btn" onclick="logout()" style="margin-top: 10px; font-size: 0.8rem;">Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±</button>
    </div>

    <script>
        const SUPABASE_URL = 'https://zflgifemhopabfzgczgs.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_9xZcd3BkgL6cEQwHJitrew_mbX74lJW';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        if (!localStorage.getItem('isLoggedIn')) window.location.href = 'index.html'; 

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„ÙˆÙ‡Ù…ÙŠ
        setInterval(() => {
            const base = 420;
            const variation = Math.floor(Math.random() * 80);
            document.getElementById('liveCounter').innerText = `Users: ${base + variation}`;
        }, 4000);

        const display = document.getElementById('randomNumber');
        const bar = document.getElementById('progressFill');
        const INTERVAL = 7000; // Ù…Ø¯Ø© Ø§Ù„Ø¬ÙˆÙ„Ø©
        let start = Date.now();
        let scrambleInterval = null;

        // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø§Ù„ÙƒØ§Ø´) Ù„Ù…Ù†Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± ÙÙŠ ÙƒÙ„ Ø¬ÙˆÙ„Ø©
        let cachedSettings = null;

        // Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ø´
        async function fetchSettingsInBackground() {
            try {
                const { data, error } = await _supabase.from('settings').select('*').eq('id', 1).single();
                if (data) {
                    cachedSettings = data;
                    // console.log("Settings updated in background"); // Ù„Ù„ØªØ¯Ù‚ÙŠÙ‚ ÙÙ‚Ø·
                }
            } catch (err) {
                console.error("Background fetch error", err);
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© Ø«Ù… ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
        fetchSettingsInBackground();
        setInterval(fetchSettingsInBackground, 5000);


        // Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ Crash
        function gen() {
            // 1. Ø¨Ø¯Ø¡ ØªØ£Ø«ÙŠØ± "Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ¹Ø©" (Matrix Effect)
            if (scrambleInterval) clearInterval(scrambleInterval);
            display.style.color = "#aaa"; 
            display.style.textShadow = "none";
            
            scrambleInterval = setInterval(() => {
                display.innerText = (Math.random() * 10 + 1).toFixed(2) + "x";
            }, 50);

            let finalNumber = "1.00";

            // 2. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ (Ø¨Ø¯ÙˆÙ† await ÙˆØ¨Ø¯ÙˆÙ† ØªØ£Ø®ÙŠØ±)
            if (cachedSettings && cachedSettings.mode === 'manual' && cachedSettings.manual_list) {
                // === Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ ===
                const numbersArr = cachedSettings.manual_list
                    .split(/[\s,]+/)
                    .map(s => s.trim())
                    .filter(s => s !== "");

                if(numbersArr.length > 0) {
                    const timeIndex = Math.floor(Date.now() / INTERVAL);
                    const arrIndex = timeIndex % numbersArr.length;
                    finalNumber = numbersArr[arrIndex];
                } else {
                    finalNumber = (Math.random() * 10 + 1).toFixed(2);
                }
            } else {
                // === Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„ÙƒØ±Ø§Ø´ ===
                const r = Math.random();
                if(r < 0.3) finalNumber = (1.00 + Math.random() * 0.50).toFixed(2);
                else if (r < 0.7) finalNumber = (1.50 + Math.random() * 2.00).toFixed(2);
                else finalNumber = (3.50 + Math.random() * 10.00).toFixed(2);
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            setTimeout(() => { 
                clearInterval(scrambleInterval); 
                
                display.style.textShadow = "0 0 20px rgba(255, 255, 255, 0.8)";
                display.style.color = "#fff";
                display.innerText = finalNumber + "x";
                
                // Ø¥Ø¶Ø§ÙØ© Ø­Ø±ÙƒØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ù†Ù‚Ø§Ø· (History Dots)
                updateDots();
                
            }, 500); 

            start = Date.now();
        }

        function updateDots() {
            const dots = document.querySelectorAll('.dot');
            dots.forEach(d => d.classList.remove('active'));
            // ØªÙØ¹ÙŠÙ„ Ù†Ù‚Ø§Ø· Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø³Ø¬Ù„
            const activeCount = Math.floor(Math.random() * 3) + 2;
            for(let i=0; i<activeCount; i++) {
                if(dots[i]) dots[i].classList.add('active');
            }
        }

        function loop() {
            let elapsed = Date.now() - start;
            let remain = INTERVAL - elapsed;
            if(remain <= 0) gen();
            else bar.style.width = ((remain/INTERVAL)*100) + "%";
            requestAnimationFrame(loop);
        }

        function logout() {
            localStorage.removeItem('isLoggedIn');
            window.location.href = 'index.html'; 
        }

        gen(); // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
        requestAnimationFrame(loop); // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ù„Ù‚Ø©
    </script>
</body>
</html>
