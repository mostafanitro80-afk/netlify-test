<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© (ROOT) | Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§ØµØ© Ø¨ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† */
        body { overflow-y: auto; } /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .container { max-width: 1200px; margin-top: 40px; padding: 20px; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel-box {
            background: rgba(10, 15, 10, 0.8);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            transition: 0.3s;
        }
        .panel-box:hover { border-color: var(--hacker-green); box-shadow: 0 0 15px rgba(0, 255, 65, 0.1); }
        .panel-header { font-size: 1.1rem; color: var(--hacker-green); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; border-bottom: 1px dashed #333; padding-bottom: 10px; }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© */
        .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: linear-gradient(145deg, #0f0f0f, #1a1a1a); padding: 20px; border-radius: 10px; border-right: 3px solid var(--hacker-green); display: flex; flex-direction: column; justify-content: center; position: relative; overflow: hidden; }
        .stat-val { font-size: 2.2rem; font-weight: 900; color: #fff; font-family: 'Fira Code'; margin: 5px 0; }
        .stat-title { color: #888; font-size: 0.85rem; }
        .stat-icon { position: absolute; left: 10px; bottom: 10px; font-size: 3rem; opacity: 0.1; }

        /* Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; margin-top: 10px; table-layout: fixed; }
        .data-table th { text-align: right; color: #aaa; padding: 10px; border-bottom: 1px solid #333; white-space: nowrap; }
        .data-table td { padding: 12px 10px; border-bottom: 1px solid #222; color: #ddd; vertical-align: middle; word-wrap: break-word; }
        .data-table tr:hover { background: rgba(255,255,255,0.02); }
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; display: inline-block; }
        .status-pending { background: rgba(255, 165, 0, 0.2); color: orange; border: 1px solid orange; }
        .status-active { background: rgba(0, 255, 65, 0.2); color: var(--hacker-green); border: 1px solid var(--hacker-green); }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØµØºÙŠØ±Ø© */
        .mini-btn { padding: 5px 10px; font-size: 0.8rem; margin: 0 2px; border-radius: 4px; cursor: pointer; border: 1px solid #444; background: #000; color: #fff; width: auto; display: inline-block; box-shadow: none; animation: none; }
        .btn-green:hover { background: var(--hacker-green); color: #000; border-color: var(--hacker-green); }
        .btn-red:hover { background: var(--danger-red); color: #fff; border-color: var(--danger-red); }
        
        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
        .admin-input { background: #000; border: 1px solid #444; padding: 10px; border-radius: 6px; color: var(--hacker-green); width: 100%; margin-bottom: 10px; font-family: 'Fira Code'; }
        
        /* Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ */
        .admin-navbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #333; }
        .nav-actions { display: flex; gap: 10px; }
        .refresh-btn { background: transparent; border: 1px solid #555; width: auto; padding: 8px 15px; margin: 0; font-size: 0.9rem; border-radius: 6px; cursor: pointer; color: #ccc; }
        .refresh-btn:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.1); }
        .logout-btn { border-color: var(--danger-red); color: var(--danger-red); }
        .logout-btn:hover { background: var(--danger-red); color: #fff; }

        /* Pagination Controls */
        .pagination-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 10px; border-top: 1px solid #333; }
        .page-info { color: #888; font-size: 0.9rem; font-family: 'Fira Code'; }

    </style>
</head>
<body>

    <div id="confirmModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="confirmTitle">[ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ]</div>
            <div class="modal-msg" id="confirmMsg">...</div>
            <div class="modal-actions">
                <button class="modal-btn" id="confirmOkBtn">ØªÙ†ÙÙŠØ°</button>
                <button class="modal-btn cancel" onclick="closeConfirm()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
    
    <div id="alertModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="alertTitle">[ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ]</div>
            <div class="modal-msg" id="alertMsg">...</div>
            <div class="modal-actions"><button class="modal-btn" onclick="closeAlert()">Ø­Ø³Ù†Ø§Ù‹</button></div>
        </div>
    </div>

    <div class="container" style="max-width: 1000px;">
        <div id="adminLogin" style="text-align: center; max-width: 400px; margin: 100px auto;">
            <img src="11zon_cropped.png" class="pro-logo" style="width: 100px;">
            <h2 id="typewriterTitle" style="margin-bottom: 30px;"></h2>
            <div class="input-wrapper">
                <input type="text" id="adminEmail" placeholder="Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (User ID)" style="text-align: center;">
            </div>
            <div class="input-wrapper">
                <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Passphrase)" style="text-align: center;">
            </div>
            <button id="authBtn" onclick="playSound('click')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
        </div>

        <div id="adminPanel" class="hidden">
            
            <div class="admin-navbar">
                <div>
                    <h2 style="margin: 0; font-size: 1.5rem;">ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h2>
                    <span style="font-size: 0.8rem; color: #666; font-family: 'Fira Code';">ROOT_ACCESS: GRANTED | V.9.6</span>
                </div>
                <div class="nav-actions">
                    <button class="refresh-btn" onclick="loadData()">ØªØ­Ø¯ÙŠØ« â†»</button>
                    <button class="refresh-btn logout-btn" onclick="adminLogout()">Ø®Ø±ÙˆØ¬ ğŸšª</button>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-card">
                    <span class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                    <span class="stat-val" id="totalCount">0</span>
                    <span class="stat-icon">ğŸ“¥</span>
                </div>
                <div class="stat-card" style="border-color: gold;">
                    <span class="stat-title" style="color: gold;">Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©</span>
                    <span class="stat-val" id="totalMoney" style="color: gold;">$0</span>
                    <span class="stat-icon">ğŸ’°</span>
                </div>
                <div class="stat-card" style="border-color: var(--danger-red);">
                    <span class="stat-title" style="color: var(--danger-red);">Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ† (Banned)</span>
                    <span class="stat-val" id="bannedCount" style="color: var(--danger-red);">0</span>
                    <span class="stat-icon">ğŸš«</span>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="panel-box">
                    <div class="panel-header"><span>ğŸ®</span> Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Signals)</div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 10px; color: #fff;">ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„:</label>
                        <div style="display: flex; gap: 15px;">
                            <label style="cursor: pointer; color: #aaa;">
                                <input type="radio" name="signalMode" value="random" checked onchange="toggleSignalInputs()"> ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ø¹Ø´ÙˆØ§Ø¦ÙŠ)
                            </label>
                            <label style="cursor: pointer; color: #aaa;">
                                <input type="radio" name="signalMode" value="manual" onchange="toggleSignalInputs()"> ÙŠØ¯ÙˆÙŠ (Ù‚Ø§Ø¦Ù…Ø© Ù…Ø³Ø¨Ù‚Ø©)
                            </label>
                        </div>
                    </div>

                    <div id="manualInputDiv" class="hidden">
                        <p style="color:#666; font-size:0.8rem; margin-bottom:5px;">Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…ÙØµÙˆÙ„Ø© Ø¨Ù…Ø³Ø§ÙØ© (Ù…Ø«Ø§Ù„: 1.50 2.30 5.00)</p>
                        <textarea id="manualNumbers" class="admin-input" style="height: 80px;" placeholder="1.00 2.00..."></textarea>
                    </div>

                    <button class="mini-btn btn-green" style="width: 100%; padding: 12px; margin-top: 10px;" onclick="saveSignalSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ğŸ’¾</button>
                </div>

                <div class="panel-box">
                    <div class="panel-header"><span>ğŸ”‘</span> Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ VIP Ø³Ø±ÙŠØ¹</div>
                    <p style="color: #666; font-size: 0.8rem; margin-bottom: 15px;">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙØ¹ÙŠÙ„ ÙƒÙˆØ¯ ÙÙˆØ±ÙŠ Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨ Ù…Ø³ØªØ®Ø¯Ù….</p>
                    
                    <input type="text" id="manualCodeInput" class="admin-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ)">
                    <button class="mini-btn btn-green" style="width: 100%; padding: 12px;" onclick="createManualCode()">Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¢Ù† âœ¨</button>
                </div>
            </div>

            <div class="panel-box" style="margin-bottom: 20px;">
                <div class="panel-header">
                    <span>ğŸ“‹</span> Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
                    <input type="text" id="searchInput" class="admin-input" placeholder="Ø¨Ø­Ø«..." style="width: 200px; margin: 0 10px 0 auto; padding: 5px;" onkeyup="filterRequests()">
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th width="15%">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th width="25%">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                <th width="15%">IP</th>
                                <th width="15%">Ø§Ù„ÙƒÙˆØ¯</th>
                                <th width="10%">Ø§Ù„Ø¥Ø«Ø¨Ø§ØªØ§Øª</th>
                                <th width="10%">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th width="10%">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="requestsList">
                            <tr><td colspan="7" style="text-align: center;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="pagination-controls">
                    <button class="mini-btn" onclick="prevPage()" id="prevBtn">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                    <span class="page-info">ØµÙØ­Ø© <span id="currPageSpan">1</span></span>
                    <button class="mini-btn" onclick="nextPage()" id="nextBtn">Ø§Ù„ØªØ§Ù„ÙŠ</button>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="panel-box" style="border-color: var(--danger-red);">
                    <div class="panel-header" style="color: var(--danger-red);"><span>ğŸš«</span> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¸Ø± (IP Ban List)</div>
                    <div id="bannedListContainer" style="max-height: 200px; overflow-y: auto;">
                        </div>
                </div>

                <div class="panel-box">
                    <div class="panel-header"><span>ğŸ’»</span> Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… (Audit Log)</div>
                    <div id="auditLog" style="height: 200px; overflow-y: auto; font-family: 'Fira Code'; font-size: 0.75rem; color: #888;">
                        Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) { if (audioCtx.state === 'suspended') audioCtx.resume(); const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.connect(gain); gain.connect(audioCtx.destination); if (type === 'click') { osc.type = 'sine'; osc.frequency.setValueAtTime(800, audioCtx.currentTime); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + 0.05); } }
        function typeWriter(text, elementId) { let i = 0; const target = document.getElementById(elementId); target.innerHTML = ""; function type() { if (i < text.length) { target.innerHTML += text.charAt(i); i++; setTimeout(type, 50); } } type(); }
        window.onload = () => {
            if(sessionStorage.getItem('adminLogged')) {
                showAdminPanel();
            } else {
                typeWriter("Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (ADMIN GATE)", "typewriterTitle");
            }
        };

        function showAlert(title, msg) { document.getElementById('alertTitle').innerText = title; document.getElementById('alertMsg').innerText = msg; document.getElementById('alertModal').classList.add('active'); }
        function closeAlert() { document.getElementById('alertModal').classList.remove('active'); }
        
        let confirmCallback = null;
        function showConfirm(title, msg, callback) { document.getElementById('confirmTitle').innerText = title; document.getElementById('confirmMsg').innerText = msg; confirmCallback = callback; document.getElementById('confirmModal').classList.add('active'); }
        function closeConfirm() { document.getElementById('confirmModal').classList.remove('active'); }
        document.getElementById('confirmOkBtn').onclick = () => { if(confirmCallback) confirmCallback(); closeConfirm(); };

        const SUPABASE_URL = 'https://zflgifemhopabfzgczgs.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_9xZcd3BkgL6cEQwHJitrew_mbX74lJW';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Ù…ØªØºÙŠØ±Ø§Øª ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª
        let currentPage = 0;
        const pageSize = 10;
        let allRequests = [];
        let totalRequests = 0;

        function escapeHtml(text) {
            if (!text) return "";
            return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('authBtn').addEventListener('click', () => {
            const e = document.getElementById('adminEmail').value; const p = document.getElementById('adminPass').value;
            // ØªØ­Ø°ÙŠØ±: ÙŠÙØ¶Ù„ ØªØºÙŠÙŠØ± Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ù‚Ù‚ Ù„ÙŠØªÙ… Ø¹Ø¨Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if(e === "mmx" && p === "mmx023123") { 
                sessionStorage.setItem('adminLogged', 'true');
                showAdminPanel();
            } else { showAlert("âŒ Ø®Ø·Ø£ Ø£Ù…Ù†ÙŠ", "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ ØºÙŠØ± ØµØ­ÙŠØ­Ø©!"); }
        });

        function showAdminPanel() {
            document.getElementById('adminLogin').classList.add('hidden'); 
            document.getElementById('adminPanel').classList.remove('hidden'); 
            loadData(); 
            loadAuditLog(); 
            loadSignalSettings(); 
        }

        function adminLogout() {
            sessionStorage.removeItem('adminLogged');
            location.reload();
        }

        async function logAction(action) {
            const time = new Date().toISOString();
            const logEntry = `[${time}] ADMIN: ${action}`;
            await _supabase.from('audit_logs').insert([{ log: logEntry }]);
            loadAuditLog();
        }

        // --- Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª ---
        function toggleSignalInputs() {
            const mode = document.querySelector('input[name="signalMode"]:checked').value;
            const div = document.getElementById('manualInputDiv');
            if(mode === 'manual') div.classList.remove('hidden'); else div.classList.add('hidden');
        }

        async function loadSignalSettings() {
            const { data, error } = await _supabase.from('settings').select('*').eq('id', 1).single();
            if(data) {
                document.querySelector(`input[name="signalMode"][value="${data.mode}"]`).checked = true;
                document.getElementById('manualNumbers').value = data.manual_list || "";
                toggleSignalInputs();
            }
        }

        async function saveSignalSettings() {
            const mode = document.querySelector('input[name="signalMode"]:checked').value;
            const list = document.getElementById('manualNumbers').value;
            showConfirm("Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŸ", async () => {
                const { error } = await _supabase.from('settings').upsert({ id: 1, mode: mode, manual_list: list });
                if(!error) { logAction(`Updated Signals: ${mode}`); showAlert("ØªÙ… âœ…", "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!"); }
            });
        }

        // --- Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ ÙŠØ¯ÙˆÙŠ ---
        async function createManualCode() {
            let code = document.getElementById('manualCodeInput').value.trim();
            if(!code) code = 'VIP-' + Math.floor(100000 + Math.random() * 900000);
            
            showConfirm("Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯", `Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯: ${code}ØŸ`, async () => {
                const { error } = await _supabase.from('active_codes').insert([{ code: code, is_active: true }]);
                if(!error) {
                    logAction(`Manual Code: ${code}`);
                    showAlert("Ù†Ø¬Ø§Ø­ âœ…", `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯: ${code}`);
                    document.getElementById('manualCodeInput').value = '';
                }
            });
        }

        // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ---
        async function activateCode(code, reqId) {
            let profit = prompt("ğŸ’° Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø£Ùˆ Ø§Ù„Ø±Ø¨Ø­) Ø§Ù„Ù…Ø­ØµÙ„:", "0");
            if (profit === null) return; 

            showConfirm("ØªÙØ¹ÙŠÙ„", `ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØªØ³Ø¬ÙŠÙ„ Ø±Ø¨Ø­ ${profit}$ØŸ`, async () => {
                await _supabase.from('active_codes').update({ is_active: true }).eq('code', code);
                await _supabase.from('requests').update({ profit: profit, status: 'active' }).eq('id', reqId);
                logAction(`Activated ${code} ($${profit})`);
                loadData();
            });
        }

        async function banUser(ip) { 
            showConfirm("Ø­Ø¸Ø± IP", `Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${ip} Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ`, async () => { 
                await _supabase.from('banned_ips').insert([{ ip: ip }]); 
                logAction(`Banned ${ip}`); loadData(); 
            }); 
        }
        
        async function unbanUser(ip) {
            showConfirm("ÙÙƒ Ø§Ù„Ø­Ø¸Ø±", `Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø± ${ip}ØŸ`, async () => {
                await _supabase.from('banned_ips').delete().eq('ip', ip);
                logAction(`Unbanned ${ip}`); loadData();
            });
        }

        async function deleteRequest(id) { 
            showConfirm("Ø­Ø°Ù", "Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ØŸ", async () => { 
                await _supabase.from('requests').delete().eq('id', id); 
                loadData(); 
            }); 
        }

        async function loadAuditLog() {
            const { data } = await _supabase.from('audit_logs').select('*').order('created_at', {ascending:false}).limit(50);
            const logBox = document.getElementById('auditLog');
            if(data) logBox.innerHTML = data.map(l => `<div style="margin-bottom:2px; border-bottom:1px solid #222; padding:2px;">${l.log}</div>`).join('');
        }

        // --- Ù†Ø¸Ø§Ù… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Pagination ---
        async function loadData() {
            const tbody = document.getElementById('requestsList'); 
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</td></tr>';
            
            // Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒÙ„ÙŠ
            const { count } = await _supabase.from('requests').select('*', { count: 'exact', head: true });
            totalRequests = count || 0;
            document.getElementById('totalCount').innerText = totalRequests;

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ù‰ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const from = currentPage * pageSize;
            const to = from + pageSize - 1;

            const { data: requests } = await _supabase
                .from('requests')
                .select('*')
                .order('created_at', {ascending:false})
                .range(from, to);

            const { data: bannedList } = await _supabase.from('banned_ips').select('*');
            updateBannedList(bannedList);

            if(requests) {
                allRequests = requests;
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ù†Ø­ØªØ§Ø¬ Ù„Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¯Ù‚Ø© - ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹)
                const { data: allProfits } = await _supabase.from('requests').select('profit');
                let totalMoney = 0;
                if(allProfits) allProfits.forEach(r => { if(r.profit) totalMoney += parseFloat(r.profit); });
                document.getElementById('totalMoney').innerText = "$" + totalMoney;
                
                renderTable();
                updatePaginationControls();
            } else { tbody.innerHTML = '<tr><td colspan="7">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>'; }
        }

        function updateBannedList(bannedList) {
            const bannedContainer = document.getElementById('bannedListContainer');
            if(bannedList && bannedList.length > 0) {
                bannedContainer.innerHTML = bannedList.map(b => `
                    <div style="display:flex; justify-content:space-between; padding:5px; border-bottom:1px solid #333;">
                        <span style="color:#fff; font-family:'Fira Code';">${b.ip}</span>
                        <button class="mini-btn btn-green" onclick="unbanUser('${b.ip}')">ÙÙƒ</button>
                    </div>
                `).join('');
                document.getElementById('bannedCount').innerText = bannedList.length;
            } else {
                bannedContainer.innerHTML = '<p style="text-align:center; color:#555;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</p>';
                document.getElementById('bannedCount').innerText = 0;
            }
        }

        function renderTable() {
            const tbody = document.getElementById('requestsList');
            const search = document.getElementById('searchInput').value.toLowerCase();
            tbody.innerHTML = '';

            // Ø§Ù„Ø¨Ø­Ø« ÙŠØªÙ… Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡ Ù„ÙŠÙƒÙˆÙ† Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±)
            const filtered = allRequests.filter(r => 
                (r.user_data && r.user_data.toLowerCase().includes(search)) || 
                (r.generated_code && r.generated_code.toLowerCase().includes(search))
            );

            if(filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>';
                return;
            }

            filtered.forEach(r => {
                const ipMatch = r.user_data.match(/IP: ([\d\.]+)/);
                const userIP = ipMatch ? ipMatch[1] : '???';
                const d = new Date(r.created_at).toLocaleDateString('ar-EG') + ' ' + new Date(r.created_at).toLocaleTimeString('ar-EG');
                const isAct = r.status === 'active';
                const statusBadge = isAct ? 
                    `<span class="status-badge status-active">Ù†Ø´Ø· (+$${r.profit})</span>` : 
                    `<span class="status-badge status-pending">Ø§Ù†ØªØ¸Ø§Ø±</span>`;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="direction:ltr; text-align:right;">${d}</td>
                    <td><div style="max-height:60px; overflow-y:auto; font-size:0.8rem; color:#aaa; white-space:pre-wrap;">${escapeHtml(r.user_data)}</div></td>
                    <td style="font-family:'Fira Code'; font-size:0.8rem;">${userIP}</td>
                    <td style="font-family:'Fira Code'; color:var(--hacker-green); font-weight:bold;">${r.generated_code}</td>
                    <td>
                        <a href="${r.reg_proof_url}" target="_blank" style="color:#fff; text-decoration:none;">ğŸ“‚</a> | 
                        <a href="${r.dep_proof_url}" target="_blank" style="color:#fff; text-decoration:none;">ğŸ’</a>
                    </td>
                    <td>${statusBadge}</td>
                    <td>
                        ${!isAct ? `<button class="mini-btn btn-green" onclick="activateCode('${r.generated_code}', ${r.id})">âœ”</button>` : ''}
                        <button class="mini-btn btn-red" onclick="banUser('${userIP}')">ğŸš«</button>
                        <button class="mini-btn" onclick="deleteRequest(${r.id})">ğŸ—‘ï¸</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function nextPage() {
            if ((currentPage + 1) * pageSize < totalRequests) {
                currentPage++;
                loadData();
            }
        }

        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                loadData();
            }
        }

        function updatePaginationControls() {
            document.getElementById('currPageSpan').innerText = currentPage + 1;
            document.getElementById('prevBtn').disabled = currentPage === 0;
            document.getElementById('nextBtn').disabled = (currentPage + 1) * pageSize >= totalRequests;
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¹Ø·Ù„Ø©
            document.getElementById('prevBtn').style.opacity = currentPage === 0 ? '0.5' : '1';
            document.getElementById('nextBtn').style.opacity = ((currentPage + 1) * pageSize >= totalRequests) ? '0.5' : '1';
        }

        function filterRequests() { renderTable(); }
    </script>
</body>
</html>
