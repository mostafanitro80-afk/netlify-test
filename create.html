<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø·Ù„Ø¨ Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯ | SYSTEM</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .device-info-box {
            background: rgba(0, 20, 0, 0.6);
            border: 1px solid var(--hacker-green);
            padding: 15px; border-radius: 8px;
            margin-bottom: 25px; text-align: right; 
            font-family: 'Fira Code', monospace; font-size: 0.8rem;
            color: #ccc; direction: rtl;
        }
        .info-row { display: flex; justify-content: space-between; margin-bottom: 5px; border-bottom: 1px dashed #333; padding-bottom: 2px; }
        .upload-icon-pulse { animation: pulse-green 2s infinite; font-size: 2rem; }
    </style>
</head>
<body>
    <div class="live-counter" id="liveCounter">Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ù†Ø´Ø·Ø©: ...</div>
    
    <div id="customModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="modalTitle">[ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ]</div>
            <div class="modal-msg" id="modalMsg">...</div>
            <div class="modal-actions"><button class="modal-btn" onclick="closeModal()">Ø­Ø³Ù†Ø§Ù‹</button></div>
        </div>
    </div>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <div id="loadingText" class="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</div>
        <div style="font-family:'Cairo'; font-size:0.8rem; color:#666; margin-top:10px;" id="loadingSubText">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</div>
    </div>

    <div class="container wide-mode" id="mainContainer" style="display:none;">
        <h2 id="typewriterTitle"></h2>
        
        <div class="device-info-box">
            <div style="color:var(--hacker-green); margin-bottom:10px;">[ ÙØ­Øµ Ø§Ù„Ø¬Ù‡Ø§Ø² ]</div>
            <div class="info-row"><span>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„:</span> <span class="info-val" id="osVal">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙƒØ´Ù...</span></div>
            <div class="info-row"><span>Ø§Ù„Ù…ØªØµÙØ­:</span> <span class="info-val" id="browserVal">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙƒØ´Ù...</span></div>
            <div class="info-row"><span>Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯:</span> <span class="info-val" id="resVal">...</span></div>
            <div class="info-row"><span>Ø§Ù„Ø­Ù…Ø§ÙŠØ©:</span> <span class="info-val">Ù…ÙØ¹Ù„Ø© (Proxy)</span></div>
        </div>

        <label class="title">>> Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©:</label>
        <div class="program-grid">
            <div class="program-option" onclick="playSound('click'); selectProgram('1x', this)"><img src="1x.png" class="program-icon"></div>
            <div class="program-option" onclick="playSound('click'); selectProgram('m', this)"><img src="m.png" class="program-icon"></div>
            <div class="program-option" onclick="playSound('click'); selectProgram('l', this)"><img src="l.png" class="program-icon"></div>
        </div>

        <label class="title">>> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:</label>
        <textarea id="userData" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¯ÙŠ (ID) Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ø®Ø±Ù‰..."></textarea>

        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 250px;">
                <label class="title">>> Ø¥Ø«Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</label>
                <label for="regProof" class="upload-box" id="regBox">
                    <div class="upload-placeholder">
                        <span class="upload-icon-pulse">ğŸ“‚</span>
                        <span id="regText" style="font-family:'Cairo'; margin-top:10px;">Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©</span>
                    </div>
                    <img id="regPreview" class="preview-img">
                    <input type="file" id="regProof" accept="image/*" onchange="handleFileSelect(this, 'regBox', 'regText', 'regPreview')">
                </label>
            </div>
            <div style="flex: 1; min-width: 250px;">
                <label class="title">>> Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹:</label>
                <label for="depProof" class="upload-box" id="depBox">
                    <div class="upload-placeholder">
                        <span class="upload-icon-pulse">ğŸ’</span>
                        <span id="depText" style="font-family:'Cairo'; margin-top:10px;">Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©</span>
                    </div>
                    <img id="depPreview" class="preview-img">
                    <input type="file" id="depProof" accept="image/*" onchange="handleFileSelect(this, 'depBox', 'depText', 'depPreview')">
                </label>
            </div>
        </div>

        <button id="submitBtn" onclick="runSubmit()">ØªÙˆÙ„ÙŠØ¯ Ù…ÙØªØ§Ø­ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        
        <div id="codeDisplay" class="hidden" style="margin-top: 30px; border-top: 1px solid rgba(0,255,0,0.2); padding-top: 20px;">
            <p style="color:var(--hacker-green); font-family:'Cairo'; font-weight:bold;">>> ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù†Ø¬Ø§Ø­:</p>
            <div style="background:rgba(0,0,0,0.8); padding:20px; border-radius:4px; border:1px dashed var(--hacker-green); margin:15px 0; font-size:2rem; font-weight:bold; letter-spacing:4px; font-family:'Fira Code'; color:#fff; text-shadow: 0 0 10px var(--hacker-green);" id="generatedCode"></div>
            
            <p style="color:#ffaa00; font-size:0.8rem; margin-bottom:15px; font-family:'Cairo';">âš ï¸ Ø§Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø¬ÙŠØ¯Ø§Ù‹. ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„Ù‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„ÙŠØ¹Ù…Ù„.</p>

            <button class="copy-btn" onclick="copyCode()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
            <br>
            <button class="secondary-btn" onclick="window.location.href='index.html'" style="margin-top:20px; width:100%; border-color:#fff; color:#fff;">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://zflgifemhopabfzgczgs.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_9xZcd3BkgL6cEQwHJitrew_mbX74lJW';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        const TELEGRAM_TOKEN = '8362386006:AAF8yKWrs7LCKva6zcu379Vn-vma1xbjF1s';
        const ADMIN_CHAT_ID = '8114406682';

        let userIP = "Unknown";
        let selectedProgram = null;

        function detectSystemInfo() {
            const ua = navigator.userAgent;
            let os = "Ù†Ø¸Ø§Ù… ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
            if (ua.indexOf("Win") != -1) os = "Windows";
            if (ua.indexOf("Mac") != -1) os = "MacOS";
            if (ua.indexOf("Linux") != -1) os = "Linux";
            if (ua.indexOf("Android") != -1) os = "Android";
            if (ua.indexOf("like Mac") != -1) os = "iOS";
            
            let browser = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
            if(ua.indexOf("Chrome") != -1) browser = "Chrome";
            else if(ua.indexOf("Safari") != -1) browser = "Safari";
            else if(ua.indexOf("Firefox") != -1) browser = "Firefox";

            document.getElementById('osVal').innerText = os;
            document.getElementById('browserVal').innerText = browser;
            document.getElementById('resVal').innerText = `${screen.width}x${screen.height}`;
        }

        function getDeviceType() {
            const ua = navigator.userAgent;
            if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) return "Tablet";
            if (/Mobile|Android|iP(hone|od)|IEMobile/.test(ua)) return "Mobile";
            return "Desktop";
        }
        function getFingerprint() { return btoa(navigator.userAgent + screen.width + screen.colorDepth).slice(0, 12); }

        setInterval(() => { document.getElementById('liveCounter').innerText = `Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ù†Ø´Ø·Ø©: ${Math.floor(Math.random() * 50) + 300}`; }, 3000);

        function showModal(title, msg) { document.getElementById('modalTitle').innerText = title; document.getElementById('modalMsg').innerText = msg; document.getElementById('customModal').classList.add('active'); playSound('click'); }
        function closeModal() { document.getElementById('customModal').classList.remove('active'); }

        async function checkBan() {
            document.getElementById('loadingOverlay').classList.add('active');
            try {
                detectSystemInfo();
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                const res = await fetch('https://api.ipify.org?format=json', { signal: controller.signal });
                clearTimeout(timeoutId);
                const data = await res.json();
                userIP = data.ip;
                const { data: banned } = await _supabase.from('banned_ips').select('*').eq('ip', userIP);
                
                if (banned && banned.length > 0) {
                    document.body.innerHTML = `<div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#000;color:red;flex-direction:column;text-align:center;"><h1 style="font-size:4rem;">ğŸš« Ù…Ø­Ø¸ÙˆØ±</h1></div>`;
                } else {
                    showMainContent();
                }
            } catch (e) { showMainContent(); }
        }

        function showMainContent() {
            document.getElementById('loadingOverlay').classList.remove('active');
            const container = document.getElementById('mainContainer');
            container.style.display = 'block';
            setTimeout(() => container.classList.add('ui-visible'), 50);
            typeWriter("Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¬Ø¯ÙŠØ¯Ø© //", "typewriterTitle");
        }

        window.onload = checkBan;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) { if (audioCtx.state === 'suspended') audioCtx.resume(); const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.connect(gain); gain.connect(audioCtx.destination); if (type === 'click') { osc.type = 'sine'; osc.frequency.setValueAtTime(800, audioCtx.currentTime); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + 0.05); } else if (type === 'success') { osc.type = 'square'; osc.frequency.setValueAtTime(400, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1); gain.gain.setValueAtTime(0.1, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + 0.3); } }
        
        function typeWriter(text, elementId) { let i = 0; const target = document.getElementById(elementId); target.innerHTML = ""; function type() { if (i < text.length) { target.innerHTML += text.charAt(i); i++; setTimeout(type, 50); } } type(); }
        
        function handleFileSelect(input, boxId, textId, previewId) { 
            if(input.files[0]) { 
                playSound('click'); 
                const file = input.files[0]; 
                document.getElementById(boxId).classList.add('uploaded'); 
                document.getElementById(textId).innerText = "ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù"; 
                document.getElementById(textId).style.color = "#0f0";
                const reader = new FileReader(); 
                reader.onload = e => { const img = document.getElementById(previewId); img.src = e.target.result; img.style.display = "block"; }; 
                reader.readAsDataURL(file); 
            } 
        }
        
        function selectProgram(name, el) { selectedProgram = name; document.querySelectorAll('.program-option').forEach(d => d.classList.remove('selected')); el.classList.add('selected'); playSound('click'); }
        function copyCode() { const code = document.getElementById('generatedCode').innerText; navigator.clipboard.writeText(code); showModal("Ù†Ø³Ø®", "ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø­Ø§ÙØ¸Ø©."); }
        
        function updateLoading(text, subtext) {
            document.getElementById('loadingText').innerText = text;
            if(subtext) document.getElementById('loadingSubText').innerText = subtext;
        }

        async function uploadImage(file) { const fileName = `${Date.now()}_${file.name.replace(/\s/g, '_')}`; const { error } = await _supabase.storage.from('proofs').upload(fileName, file); if(error) throw error; const { data } = _supabase.storage.from('proofs').getPublicUrl(fileName); return data.publicUrl; }
        
        async function sendToTelegram(program, data, code, regUrl, depUrl, ip, device) { 
            const apiUrl = `https://api.telegram.org/bot${TELEGRAM_TOKEN}`; 
            const message = `ğŸš¨ <b>Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯!</b>\nğŸŒ <b>IP:</b> ${ip}\nğŸ“± <b>Ø§Ù„Ø¬Ù‡Ø§Ø²:</b> ${device}\nğŸ’» <b>${program}</b>\nğŸ‘¤ <b>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</b>\n${data}\n\nğŸ”‘ <code>${code}</code>`; 
            fetch(`${apiUrl}/sendMessage`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ chat_id: ADMIN_CHAT_ID, text: message, parse_mode: 'HTML' }) }); 
        }

        async function runSubmit() {
            playSound('click');
            const userData = document.getElementById('userData').value;
            const regFile = document.getElementById('regProof').files[0];
            const depFile = document.getElementById('depProof').files[0];
            const btn = document.getElementById('submitBtn');

            if(!selectedProgram) { showModal("Ø®Ø·Ø£", "ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØµØ© (Ø§Ù„Ø³ÙƒØ±Ø¨Øª)."); return; }
            if(!userData) { showModal("Ø®Ø·Ø£", "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø·Ù„ÙˆØ¨Ø©."); return; }
            if(!regFile || !depFile) { showModal("Ø®Ø·Ø£", "ÙŠØ¬Ø¨ Ø±ÙØ¹ ØµÙˆØ± Ø§Ù„Ø¥Ø«Ø¨Ø§Øª."); return; }

            document.getElementById('loadingOverlay').classList.add('active');
            
            try {
                updateLoading("Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...", "ÙŠØªÙ… ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
                await new Promise(r => setTimeout(r, 1000));

                updateLoading("ØªØ´ÙÙŠØ± Ø§Ù„Ù…Ù„ÙØ§Øª...", "Ø¬Ø§Ø±ÙŠ Ø¶ØºØ· Ø§Ù„ØµÙˆØ±...");
                const [regUrl, depUrl] = await Promise.all([
                    uploadImage(regFile),
                    uploadImage(depFile)
                ]);

                updateLoading("Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...", "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...");
                await new Promise(r => setTimeout(r, 800));

                const code = 'KEY-' + Math.floor(100000 + Math.random() * 900000);
                const device = getDeviceType();
                const fp = getFingerprint();
                const fullData = `System: [${selectedProgram}] | IP: ${userIP}\nDevice: ${device} | FP: ${fp}\n${userData}`;

                await _supabase.from('requests').insert([{ user_data: fullData, reg_proof_url: regUrl, dep_proof_url: depUrl, generated_code: code }]);
                await _supabase.from('active_codes').insert([{ code: code, is_active: false }]);

                sendToTelegram(selectedProgram, userData, code, regUrl, depUrl, userIP, device);

                updateLoading("Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©...", "ØªÙ… Ø¨Ù†Ø¬Ø§Ø­.");
                await new Promise(r => setTimeout(r, 500));
                document.getElementById('loadingOverlay').classList.remove('active');

                playSound('success'); 
                showModal("ØªÙ… Ø¨Ù†Ø¬Ø§Ø­", "ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.");
                
                document.getElementById('codeDisplay').classList.remove('hidden');
                document.getElementById('generatedCode').innerText = code;
                btn.style.display = 'none';
                document.getElementById('codeDisplay').scrollIntoView({ behavior: 'smooth' });

            } catch (e) { 
                console.error(e); 
                document.getElementById('loadingOverlay').classList.remove('active'); 
                showModal("Ø®Ø·Ø£ Ù‚Ø§ØªÙ„", "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±. Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹."); 
            }
        }
    </script>
</body>
</html>
